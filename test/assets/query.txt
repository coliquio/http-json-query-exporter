GET /logs-*/_search
{
  "size": 0,
  "query": {
    "range": {
      "@timestamp": {
        "gte": "now-3600s/s",
        "lte": "now/s"
      }
    }
  },
  "aggs": {
    "status_code_range": {
       "range": {
          "field": "status_code",
          "ranges": [
            {
              "to": 199
            },
            {
              "from": 400
            }
          ]
          
        },
        "aggs": {
          "pages": {
            "terms": {
              "field": "req_path.keyword",
              "include" : "/.*",
              "size" : 10
            },
            "aggs": {
              "status_codes": {
                "terms": {
                  "field": "status_code",
                  "size" : 5
                }
              }
            }
          }
        }
      }
    }
  }